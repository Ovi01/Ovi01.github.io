<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Экспертная система</title>
    <link rel="stylesheet" href="es.css">
  </head>

  <body>
    <!-- <br><div id="title"></div>
    -->

    <table id="dialog">
      <tr id="reload">
        <td class="quest" id="quest"></td>
      </tr>
      <tr class="line line0">
        <td class="answer" id="answer0"></td>
      </tr>
      <tr class="line line1">
        <td class="answer" id="answer1"></td>
      </tr>
      <tr class="line line2">
        <td class="answer" id="answer2"></td>
      </tr>
      <tr class="line line3">
        <td class="answer" id="answer3"></td>
      </tr>
      <tr class="line line4">
        <td class="answer" id="answer4"></td>
      </tr>
      <tr class="line line5">
        <td class="answer" id="answer5"></td>
      </tr>
    </table>

    <div id="result"></div>
    <div id="description"></div>

    <script src="db.js"></script> <!--база знаний-->
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    <script src="es_bin.js"></script> <!--база знаний-->
  </body>
</html>
<script>
  let node = es.root;
    for(let i = node.answers.length; i < 6; i++) {
      console.log($('.line' + i));
      $('.line' + i).hide();
    };

  const next_node = (inner) => {
    node = node.nextRules[inner[inner.length-1]];
    if(!node.answers) {
      print_end(node);
      return;
    };
    for(let i = node.answers.length; i < 6; i++) {
      console.log($('.line' + i));
      $('.line' + i).hide();
    };
    ask(node);
  };

  const ask = (node) => {
    if(!node.question) {
      print_end(node);
      return;
    };

    console.log($('#quest').html(node.question));
    for(let i in node.answers) {
      $('.line' + i).show();
      $('#answer' + i).html(node.answers[i])
    };
  };

  const print_end = (node) => {
    $('#dialog').hide();
    $('#result').html(node.result);
    $('#description').html(node.description);
  };

  let colors = ['#464', '#777']; // массив цветов выкл/вкл
  document // при клике по ячейке таблицы
    .querySelectorAll('#dialog .answer') // найти массив ячеек таблицы с ответами
    .forEach(td_answer => { // для каждой ячейки назначить обработчики событий
      td_answer.addEventListener("click", () => next_node(event.target.id));
      td_answer.addEventListener('mouseenter', () => td_answer.style.backgroundColor = colors[1]);
      td_answer.addEventListener('mouseleave', () => td_answer.style.backgroundColor = colors[0]);
    });

  ask(node);

</script>
